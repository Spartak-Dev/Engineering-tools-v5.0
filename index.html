<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Engineering Tools 5.0 - Universal Arsenal</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; background-color: #1a1a1a; color: white; margin: 0; padding: 20px; }
        .container { background: #2d2d2d; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; border: 1px solid #444; width: 450px; }
        button { display: block; width: 100%; margin: 10px 0; padding: 12px; font-size: 14px; font-weight: bold; cursor: pointer; border: none; border-radius: 8px; background-color: #007bff; color: white; transition: 0.3s; }
        button.new-tool { background-color: #ff9900; }
        button.audit-tool { background-color: #8a2be2; }
        button.architect-tool { background-color: #28a745; border: 1px solid #fff; }
        button.save-btn { background-color: #555; margin-top: 15px; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        h2 { margin-bottom: 20px; color: #00cc66; text-transform: uppercase; font-size: 22px; }
        .arsenal-section { margin-top: 25px; padding: 15px; background: #222; border-radius: 10px; border: 1px dashed #555; }
        .arsenal-section h4 { margin: 0 0 10px 0; color: #ff9900; font-size: 14px; text-transform: uppercase; }
        .device-list { text-align: left; margin-bottom: 10px; font-size: 13px; }
        .device-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #444; }
        .delete-btn { color: #ff4444; cursor: pointer; padding: 5px 10px; font-weight: bold; background: rgba(255,68,68,0.1); border-radius: 4px; }
        .footer { font-size: 10px; color: #666; margin-top: 20px; text-transform: uppercase; }
        .warning { color: #ff4444; font-weight: bold; margin-top: 10px; border: 1px solid #ff4444; padding: 5px; border-radius: 5px; font-size: 13px; }
        .converter-content {
    display: none; /* –°—Ö–æ–≤–∞–Ω–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º */
    background-color: #2c2c2c; /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω */
    color: #ffffff; /* –ë—ñ–ª–∏–π —Ç–µ–∫—Å—Ç */
    padding: 15px;
    border-radius: 10px;
    border: 1px solid #4CAF50; /* –ó–µ–ª–µ–Ω–∞ —Ä–∞–º–∫–∞ */
    margin-top: 10px;
    box-shadow: 0px 4px 15px rgba(0,0,0,0.3); /* –õ–µ–≥–∫–∞ —Ç—ñ–Ω—å –¥–ª—è –æ–±'—î–º—É */
}

/* –°—Ç–∏–ª—å –ø–æ–ª—ñ–≤ –≤–≤–µ–¥–µ–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–∞ */
.converter-content input {
    background-color: #3d3d3d;
    border: 1px solid #4CAF50;
    color: white;
    padding: 5px;
    border-radius: 5px;
    margin: 5px 0;
}

/* –°—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É (=) */
.converter-content button {
    background-color: #4CAF50;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
}

.converter-content button:hover {
    background-color: #45a049;
}

.converter-btn {
    background-color: #4CAF50;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    width: 100%;
    font-weight: bold;
    transition: 0.3s;
}

.converter-btn:hover {
    background-color: #45a049;
    transform: scale(1.02); /* –õ–µ–≥–∫–µ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–Ω—ñ */
}

    </style>
</head>
<body>

<div class="container">
    <h2>Engineering Tools v5.0</h2>
    
    <button onclick="calcPowerbank()">1. –ó–∞—Ä—è–¥–∫–∞ –ü–ë (–î–∏–Ω–∞–º—ñ–∫–∞)</button>
    <button onclick="calcLiIon()">2. –ó–∞—Ä—è–¥–∫–∞ Li-ion –∞–∫—É–º—É–ª—è—Ç–æ—Ä—ñ–≤ </button>
    <button class="new-tool" onclick="calcWorkTime()">3. –ß–∞—Å —Ä–æ–±–æ—Ç–∏ (Pro Mode)</button>
    <button class="audit-tool" onclick="calcLightTime()">4. –°–∫—ñ–ª—å–∫–∏ –±—É–ª–æ —Å–≤—ñ—Ç–ª–æ?</button>
    <button class="architect-tool" onclick="calcChargeStats()">5. –ê–Ω–∞–ª—ñ–∑: –°–∫—ñ–ª—å–∫–∏ –∑–∞—Ä—è–¥–æ–∫ —ñ % –ø–± –∑–∞–ª–∏—à–∏—Ç—å—Å—è</button>
    <button class="new-tool" onclick="calcFlashlight()">6. –†–æ–±–æ—Ç–∞ –ª—ñ—Ö—Ç–∞—Ä–∏–∫–∞</button>
    <button class="new-tool" onclick="survivalMode()">7. –†–µ–∂–∏–º –≤–∏–∂–∏–≤–∞–Ω–Ω—è (–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è)</button>
<button class="audit-tool" onclick="auditPowerbank()">8. –ê—É–¥–∏—Ç –ü–ë (–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ—ó —è–∫–æ—Å—Ç—ñ)</button>
<button onclick="calcHomeBackup()">9. Home Backup (–ö–≤–∞—Ä—Ç–∏—Ä–∞/–î–ë–ñ)</button>
<button onclick="calcRecharge()">10. –†–µ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è (–ó–∞—Ä—è–¥–∫–∞ –≤–µ–ª–∏–∫–∏—Ö –ê–ö–ë/–°—Ç–∞–Ω—Ü—ñ–π)</button>


<div style="margin: 20px 0;">
    <button class="converter-btn" onclick="toggleConverter()">üîÑ –í—ñ–¥–∫—Ä–∏—Ç–∏ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –í–µ–ª–∏—á–∏–Ω</button>
    
    <div id="converter" class="converter-content">
        <h4>–®–≤–∏–¥–∫–∏–π –ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫:</h4>
        
        <p>mAh ‚û°Ô∏è Ah:<br>
        <input type="number" id="conv_mah" placeholder="–í–≤–µ–¥—ñ—Ç—å mAh" oninput="convertMah()" style="width: 80%;"> 
        = <b><span id="res_ah">0</span> Ah</b></p>

        <p>Ah + V ‚û°Ô∏è Wh:<br>
        <input type="number" id="conv_ah" placeholder="Ah" style="width: 30%;"> √ó 
        <input type="number" id="conv_v" placeholder="V" value="3.7" style="width: 30%;"> 
        <button onclick="convertWh()">=</button> <b><span id="res_wh">0</span> Wh</b></p>

        <p>–ê + V ‚û°Ô∏è W:<br>
        <input type="number" id="conv_amp" placeholder="–ê" style="width: 30%;"> √ó 
        <input type="number" id="conv_volt" placeholder="V" style="width: 30%;"> 
        <button onclick="convertW()">=</button> <b><span id="res_w">0</span> W</b></p>
    </div>
    
</div>

    <div id="statusArea"></div>
    <div id="saveArea" style="display:none;">
        <button class="save-btn" onclick="downloadReport()">üíæ –ó–ê–í–ê–ù–¢–ê–ñ–ò–¢–ò –ó–í–Ü–¢ (.txt)</button>
    </div>

    <div class="arsenal-section">
        <h4>üì¶ –ú–Ü–ô –ê–†–°–ï–ù–ê–õ</h4>
        <div id="deviceList" class="device-list">–ê—Ä—Å–µ–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π</div>
        <button onclick="addDeviceToStorage()" style="background:#444; font-size: 11px; padding: 8px;">+ –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π</button>
    </div>

    <div class="footer">–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –º–æ–¥–µ–ª—å –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞ v4.3</div>
</div>

</div>

<script>
let lastReport = "";

// --- –†–û–ë–û–¢–ê –ó –ü–ê–ú'–Ø–¢–¢–Æ ---
function getStoredDevices() {
    const devices = localStorage.getItem('eng_tools_v4_data');
    return devices ? JSON.parse(devices) : [];
}

function renderDeviceList() {
    const listDiv = document.getElementById('deviceList');
    const devices = getStoredDevices();
    if (devices.length === 0) { listDiv.innerHTML = "–ê—Ä—Å–µ–Ω–∞–ª –ø–æ—Ä–æ–∂–Ω—ñ–π"; return; }
    listDiv.innerHTML = devices.map((d, i) => `
        <div class="device-item">
            <span><b>${d.name}</b> (${d.mah}mAh | ${d.watts}W)</span>
            <span class="delete-btn" onclick="deleteDevice(${i})">‚úï</span>
        </div>
    `).join('');
}

function addDeviceToStorage() {
    let name = prompt("–ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é:");
    if (!name) return;
    let mah = Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å (mAh):"));
    let watts = Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) - –∑–∞—Ä—è–¥–∫–∏ –∞–±–æ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è:"));
    let devices = getStoredDevices();
    devices.push({ name, mah, wh: (mah/1000)*3.7, watts });
    localStorage.setItem('eng_tools_v4_data', JSON.stringify(devices));
    renderDeviceList();
}

function deleteDevice(index) {
    let devices = getStoredDevices();
    devices.splice(index, 1);
    localStorage.setItem('eng_tools_v4_data', JSON.stringify(devices));
    renderDeviceList();
}

// –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä –ø—Ä–∏—Å—Ç—Ä–æ—é
function selectDevice() {
    let devices = getStoredDevices();
    if (devices.length > 0 && confirm("–í–∏–±—Ä–∞—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –ê—Ä—Å–µ–Ω–∞–ª—É?")) {
        let options = devices.map((d, i) => `${i}: ${d.name}`).join('\n');
        let choice = prompt("–í–∏–±–µ—Ä—ñ—Ç—å –Ω–æ–º–µ—Ä:\n" + options);
        return devices[choice] || null;
    }
    return null;
}
function toggleConverter() {
    let content = document.getElementById("converter");
    if (content.style.display === "block") {
        content.style.display = "none";
    } else {
        content.style.display = "block";
    }
}

// –¢—ñ –∂ —Å–∞–º—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É
function convertMah() {
    let mah = document.getElementById('conv_mah').value;
    document.getElementById('res_ah').innerText = (mah / 1000).toFixed(2);
}

function convertWh() {
    let ah = document.getElementById('conv_ah').value;
    let v = document.getElementById('conv_v').value;
    document.getElementById('res_wh').innerText = (ah * v).toFixed(2);
}

function convertW() {
    let a = document.getElementById('conv_amp').value;
    let v = document.getElementById('conv_volt').value;
    document.getElementById('res_w').innerText = (a * v).toFixed(2);
}

// --- –£–¢–ò–õ–Ü–¢–ò ---
function formatTime(totalMinutes) {
    if (totalMinutes <= 0 || isNaN(totalMinutes)) return "0 —Ö–≤.";
    let h = Math.floor(totalMinutes / 60);
    let m = Math.round(totalMinutes % 60);
    return h > 0 ? `${h} –≥–æ–¥. ${m} —Ö–≤.` : `${m} —Ö–≤.`;
}

const CV_TIME_ADJUSTMENT = 1.25; // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç —Å–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –¥–ª—è —Ñ–∞–∑–∏ CV


// --- –§–£–ù–ö–¶–Ü–á ---
//–ö–Ω–æ–ø–∫–∞ 1
function calcPowerbank() {
    let dev = selectDevice();
    let mah = dev ? dev.mah : Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å –ü–ë (mAh):"));
    let wh = dev ? dev.wh : (mah / 1000) * 3.7;
    let watts = dev ? dev.watts : Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ (W):"));
    
    let p = Number(prompt("–ü–æ—Ç–æ—á–Ω–∏–π % –∑–∞—Ä—è–¥—É:"));
    let totalMinutes = 0;
    for (let i = p; i < 100; i++) {
        let eff = watts * 0.85;
        if (i >= 80 && i < 90) eff *= 0.7;
        else if (i >= 90) eff *= 0.35;
        totalMinutes += ((wh / 100) / eff) * 60;
    }
    alert(`–ß–∞—Å –∑–∞—Ä—è–¥–∫–∏: ${formatTime(totalMinutes)}`);
}

// –ö–Ω–æ–ø–∫–∞ 2: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ Li-ion (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º CC/CV —Ñ–∞–∑)
function calcLiIon() {
    let E = Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞ (mAh):"));
    let U = Number(prompt("–ù–∞–ø—Ä—É–≥–∞ –∑–∞—Ä—è–¥–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (V):")); // –ó–∞–∑–≤–∏—á–∞–π 5V
    let A = Number(prompt("–°—Ç—Ä—É–º –∑–∞—Ä—è–¥–∫–∏ (A):")); // –ù–∞–ø—Ä–∏–∫–ª–∞–¥, 1A
    
    if (E > 0 && U > 0 && A > 0) {
        // 1. –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –±–∞–∑–æ–≤–æ–≥–æ —á–∞—Å—É (—Ñ–∞–∑–∞ CC - Constant Current)
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É —Ñ–æ—Ä–º—É–ª—É –µ–Ω–µ—Ä–≥—ñ—ó –∑ –ö–ö–î 0.85
        let baseHours = (E * 3.7) / (U * A * 1000 * 0.85);
        
        // 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è CV-–∫–æ—Ä–µ–∫—Ü—ñ—ó (Constant Voltage)
        // –î–ª—è –æ–∫—Ä–µ–º–∏—Ö Li-ion –∞–∫—É–º—É–ª—è—Ç–æ—Ä—ñ–≤ —Ñ–∞–∑–∞ CV –∑–∞–±–∏—Ä–∞—î –±–∞–≥–∞—Ç–æ —á–∞—Å—É.
        // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç 1.3 (–¥–æ–¥–∞—Ç–∫–æ–≤—ñ 30% —á–∞—Å—É –Ω–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—é –Ω–∞–ø—Ä—É–≥–∏)
        let totalTimeMinutes = (baseHours * 60) * 1.3;

        let report = `–ü–†–û–ì–ù–û–ó –ó–ê–†–Ø–î–ö–ò Li-ion:
---------------------------
–ë–∞–∑–æ–≤–∏–π —á–∞—Å (CC): ${formatTime(baseHours * 60)}
–ó —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º CV (100%): ${formatTime(totalTimeMinutes)}
---------------------------
*–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç 1.3 –≤—Ä–∞—Ö–æ–≤—É—î —Å–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —Å—Ç—Ä—É–º—É –Ω–∞ —Ñ—ñ–Ω–∞–ª—å–Ω—ñ–π —Å—Ç–∞–¥—ñ—ó –∑–∞—Ä—è–¥—É.`;

        alert(report);
    } else {
        alert("–ü–æ–º–∏–ª–∫–∞: –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ —Ü–∏—Ñ—Ä–∏.");
    }
}

//–ö–Ω–æ–ø–∫–∞ 3
function calcWorkTime() {
    let batteryWh = 0;

    // 1. –ü–∏—Ç–∞—î–º–æ –ø—Ä–æ Wh
    if (confirm("–ß–∏ –∑–Ω–∞—î—Ç–µ –≤–∏ —î–º–Ω—ñ—Å—Ç—å –ø–∞–≤–µ—Ä–±–∞–Ω–∫—É —É Wh?")) {
        batteryWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh –≤–∞—à–æ–≥–æ –ø–±:"));
    } else {
        // –Ø–∫—â–æ –Ω–µ –∑–Ω–∞—î - —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —á–µ—Ä–µ–∑ mAh
        let mah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å —î–º–Ω—ñ—Å—Ç—å —É mAh:"));
        let volts = Number(prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞ (–∑–∞–∑–≤–∏—á–∞–π 3.7 –¥–ª—è –ø–∞–≤–µ—Ä–±–∞–Ω–∫—ñ–≤):", "3.7"));
        batteryWh = (mah * volts) / 1000;
    }

    // –†–µ—à—Ç–∞ –ª–æ–≥—ñ–∫–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
    let maxPower = Number(prompt("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –≤–∏—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –≤–∞—à–æ–≥–æ –ø–± (W):"));
    let count = Number(prompt("–°–∫—ñ–ª—å–∫–∏ —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ?"));
    let totalW = 0;

    for (let i = 1; i <= count; i++) {
        if (confirm(`–°–ø–æ–∂–∏–≤–∞—á ‚Ññ${i}: –ó–Ω–∞—î—Ç–µ –π–æ–≥–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —É –í–∞—Ç–∞—Ö (W)?`)) {
            totalW += Number(prompt(`–í–≤–µ–¥—ñ—Ç—å –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) —Å–ø–æ–¥–∏–≤–∞—á—É ‚Ññ${i}:`));
        } else {
            let v = Number(prompt(`–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É (V) —Å–ø–æ–¥–∏–≤–∞—á–∞ ‚Ññ${i}:`));
            let a = Number(prompt(`–í–≤–µ–¥—ñ—Ç—å —Å—Ç—Ä—É–º (A) —Å–ø–æ–∂–∏–≤–∞—á–∞ ‚Ññ${i}:`));
            totalW += v * a;
        }
    }

    let totalMinutes = (batteryWh / totalW) * 60;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    if (totalW > maxPower) {
        document.getElementById('statusArea').innerHTML = `<div class="warning">‚ö†Ô∏è –£–í–ê–ì–ê: –ü–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è! –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è (${totalW}W) –±—ñ–ª—å—à–µ –ª—ñ–º—ñ—Ç—É (${maxPower}W)</div>`;
    } else {
        document.getElementById('statusArea').innerHTML = "";
    }

    lastReport = `–ó–í–Ü–¢: –ß–ê–° –†–û–ë–û–¢–ò (Pro Mode)\n-------------------\n–ï–Ω–µ—Ä–≥—ñ—è –ø–±: ${batteryWh.toFixed(2)} Wh\n–°—É–º–∞—Ä–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${totalW.toFixed(2)} W\n–ß–∞—Å —Ä–æ–±–æ—Ç–∏: ${formatTime(totalMinutes)}`;
    
    alert(lastReport);
    document.getElementById('saveArea').style.display = "block";
}
//–ö–Ω–æ–ø–∫–∞ 4
function calcLightTime() {
    let dev = selectDevice();
    let wh = dev ? dev.wh : (Number(prompt("–Ñ–º–Ω—ñ—Å—Ç—å –ü–ë (mAh):")) / 1000) * 3.7;
    let p1 = Number(prompt("% —Å–ø–æ—á–∞—Ç–∫—É:"));
    let p2 = Number(prompt("% –≤ –∫—ñ–Ω—Ü—ñ:"));
    let w = dev ? dev.watts : Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ (W):"));
    let mins = ((wh * (p2 - p1) / 100) / (w * 0.85)) * 60;
    alert(`–°–≤—ñ—Ç–ª–æ –±—É–ª–æ: ${formatTime(mins)}`);
}

// --- 5. –ê–ù–ê–õ–Ü–ó: –°–ö–Ü–õ–¨–ö–ò –ó–ê–†–Ø–î–û–ö –Ü % –ü–ë –ó–ê–õ–ò–®–ò–¢–¨–°–Ø (v5.0) ---
function calcChargeStats() {
    let p1 = confirm("–ó–Ω–∞—î—Ç–µ Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞?") 
        ? Number(prompt("1. –í–≤–µ–¥—ñ—Ç—å Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) 
        : (Number(prompt("1. –í–≤–µ–¥—ñ—Ç—å mAh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) / 1000) * 3.7;

    let p2 = Number(prompt("2. –Ø–∫–∏–π –∑–∞—Ä–∞–∑ % –∑–∞—Ä—è–¥—É –ü–ë?"));
    let p4 = Number(prompt("3. –°–∫—ñ–ª—å–∫–∏ —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ –ø–ª–∞–Ω—É—î—Ç–µ –∑–∞—Ä—è–¥–∏—Ç–∏?"));
    let chargePower = Number(prompt("4. –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–∫–∏ (W):")) || 10;

    let tempPB_Wh = p1 * (p2 / 100);
    let reportDetails = "";
    let totalTimeMinutes = 0;

    for (let i = 1; i <= p4; i++) {
        let p5 = confirm(`–°–ø–æ–∂–∏–≤–∞—á ‚Ññ${i}: –ó–Ω–∞—î—Ç–µ Wh?`) 
            ? Number(prompt(`‚Ññ${i}: –ü–æ–≤–Ω–∞ –º—ñ—Å—Ç–∫—ñ—Å—Ç—å Wh:`)) 
            : (Number(prompt(`‚Ññ${i}: –ü–æ–≤–Ω–∞ –º—ñ—Å—Ç–∫—ñ—Å—Ç—å mAh:`)) / 1000) * 3.7;
        
        let p6 = Number(prompt(`‚Ññ${i}: –ü–æ—Ç–æ—á–Ω–∏–π % —Å–ø–æ–∂–∏–≤–∞—á–∞?`));
        let deviceCurrentWh = p5 * (p6 / 100);
        let neededWh = p5 - deviceCurrentWh; 
        let neededFromBank = neededWh / 0.85; 

        let finalPercent = 0;
        let chargeTimeHours = 0;
        let effPower = chargePower * 0.85; // –†–µ–∞–ª—å–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ö–ö–î

        if (tempPB_Wh >= neededFromBank) {
            finalPercent = 100;
            // --- –í–°–¢–ê–í–ö–ê –ù–û–í–û–á –õ–û–ì–Ü–ö–ò (CC/CV split) ---
            if (p6 < 80) {
                // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ –µ–Ω–µ—Ä–≥—ñ—é –¥–æ –ø–æ—Ä–æ–≥—É 80%
                let whTo80 = (p5 * 0.8) - deviceCurrentWh;
                let whAfter80 = p5 * 0.2;
                
                // –ß–∞—Å = (–ß–∞—Å –¥–æ 80% –Ω–∞ –ø–æ–≤–Ω—ñ–π —à–≤–∏–¥–∫–æ—Å—Ç—ñ) + (–ß–∞—Å –ø—ñ—Å–ª—è 80% –∑—ñ —Å–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è–º —Ö1.5)
                chargeTimeHours = (whTo80 / effPower) + (whAfter80 / effPower * 1.5);
            } else {
                // –Ø–∫—â–æ –≤–∂–µ > 80%, –≤—Å—è –∑–∞—Ä—è–¥–∫–∞ –π–¥–µ –≤ –ø–æ–≤—ñ–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ CV
                chargeTimeHours = (neededWh / effPower) * 1.5;
            }
            tempPB_Wh -= neededFromBank;
        } else {
            // –í–∏–ø–∞–¥–æ–∫, –∫–æ–ª–∏ –ü–ë –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î
            let availableWh = tempPB_Wh * 0.85;
            finalPercent = ((deviceCurrentWh + availableWh) / p5) * 100;
            
            // –Ø–∫—â–æ –∑–∞—Ä—è–¥–∫–∞ –æ–±—ñ—Ä–≤–µ—Ç—å—Å—è –¥–æ 80%, —Ä–∞—Ö—É—î–º–æ –±–µ–∑ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞
            if (finalPercent <= 80) {
                chargeTimeHours = availableWh / effPower;
            } else {
                // –Ø–∫—â–æ –≤—Å—Ç–∏–≥–Ω–µ –∑–∞–π—Ç–∏ —É —Ñ–∞–∑—É CV
                let whTo80 = Math.max(0, (p5 * 0.8) - deviceCurrentWh);
                let whInCV = availableWh - whTo80;
                chargeTimeHours = (whTo80 / effPower) + (whInCV / effPower * 1.5);
            }
            tempPB_Wh = 0;
        }

        let minutes = Math.round(chargeTimeHours * 60);
        totalTimeMinutes += minutes;
        reportDetails += `üîπ –°–ø–æ–∂–∏–≤–∞—á ‚Ññ${i}: –¥–æ ${finalPercent.toFixed(1)}% (‚âà${formatTime(minutes)})\n`;
    }

    // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–≤—ñ—Ç—É (—è–∫ —É —Ç–≤–æ—ó—Ö –ø—É–Ω–∫—Ç–∞—Ö –æ–Ω–æ–≤–ª–µ–Ω—å)
    let totalH = Math.floor(totalTimeMinutes / 60);
    let totalM = totalTimeMinutes % 60;
    let finalPBPercent = (tempPB_Wh / p1) * 100;

    let res = `–ó–í–Ü–¢\n–ó–∞–ª–∏—à–æ–∫ –ü–ë: ${finalPBPercent.toFixed(1)}%\n\n${reportDetails}\n‚è± –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: ${totalH}–≥ ${totalM}—Ö–≤`;
    alert(res);
}

//–ö–Ω–æ–ø–∫–∞ 6
function formatTime(totalMinutes) {
    const hours = Math.floor(totalMinutes / 60);
    const mins = Math.round(totalMinutes % 60);
    return hours > 0 ? `${hours} –≥–æ–¥. ${mins} —Ö–≤.` : `${mins} —Ö–≤.`;
}

function calcFlashlight() {
    // 1. –ü–∏—Ç–∞—î–º–æ –ø—Ä–æ —î–º–Ω—ñ—Å—Ç—å
    let mah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å —î–º–Ω—ñ—Å—Ç—å –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞ (mAh):"));
    
    // 2. –ü–∏—Ç–∞—î–º–æ –ø—Ä–æ –ø–æ—Ç–æ—á–Ω–∏–π –∑–∞—Ä—è–¥
    let percentage = Number(prompt("–Ø–∫–∏–π –∑–∞—Ä–∞–∑ % –∑–∞—Ä—è–¥—É? (0-100):"));
    
    // 3. –ü–∏—Ç–∞—î–º–æ –ø—Ä–æ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å (–ª—é–º–µ–Ω–∏)
    let lm = Number(prompt("–í–≤–µ–¥—ñ—Ç—å —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å —É –ª—é–º–µ–Ω–∞—Ö (lm):"));

    // 4. –ü–µ—Ä–µ–≤–æ–¥–∏–º–æ mAh —É Wh (–±–∞–∑—É—é—á–∏—Å—å –Ω–∞ 3.7V)
    let totalWh = (mah / 1000) * 3.7;
    
    // 5. –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–æ—Ç–æ—á–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–Ω–µ—Ä–≥—ñ—ó (Wh) —á–µ—Ä–µ–∑ –≤—ñ–¥—Å–æ—Ç–æ–∫
    let currentWh = (percentage / 100) * totalWh;
    
    // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) = –õ—é–º–µ–Ω–∏ / 100
    let powerW = lm / 100;

    if (powerW <= 0) {
        alert("–ü–æ–º–∏–ª–∫–∞: –ª—é–º–µ–Ω–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0");
        return;
    }

    // –ß–∞—Å —Ä–æ–±–æ—Ç–∏ –≤ –≥–æ–¥–∏–Ω–∞—Ö: Wh / W
    let runtimeHours = currentWh / powerW;
    
    alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç:
-------------------------
–Ñ–º–Ω—ñ—Å—Ç—å: ${currentWh.toFixed(2)} Wh (–ø—Ä–∏ ${percentage}%)
–°–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${powerW.toFixed(2)} W
–û—á—ñ–∫—É–≤–∞–Ω–∏–π —á–∞—Å —Ä–æ–±–æ—Ç–∏: ${formatTime(runtimeHours * 60)}`);
}

// 7. –°–¢–†–ê–¢–ï–ì–Ü–Ø –í–ò–ñ–ò–í–ê–ù–ù–Ø (–£–Ω—ñ–∫–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è)
function survivalMode() {
    let wh = confirm("–ó–Ω–∞—î—Ç–µ Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞?") 
        ? Number(prompt("Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) 
        : (Number(prompt("mAh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞:")) / 1000) * 3.7;
    
    let p = Number(prompt("–Ø–∫–∏–π –∑–∞—Ä–∞–∑ % –∑–∞—Ä—è–¥—É –ü–ë?"));
    let hoursNeeded = Number(prompt("–°–∫—ñ–ª—å–∫–∏ –≥–æ–¥–∏–Ω —â–µ –ù–ï –ë–£–î–ï —Å–≤—ñ—Ç–ª–∞? (–≥–æ–¥)"));
    
    let currentEnergy = wh * (p / 100) * 0.85; // –ï–Ω–µ—Ä–≥—ñ—è –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –ö–ö–î
    let maxW = currentEnergy / hoursNeeded;

    let result = `–©–û–ë –í–ò–¢–†–ò–ú–ê–¢–ò ${hoursNeeded} –ì–û–î–ò–ù:\n–í–∞—à –ª—ñ–º—ñ—Ç —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è: ${maxW.toFixed(2)} W`;
 /*   
    // –î–æ–¥–∞—î–º–æ –ø–æ—Ä–∞–¥—É –≤—ñ–¥ —Å–∏—Å—Ç–µ–º–∏
    let advice = "";
    if (maxW < 2) advice = "\n–ü–æ—Ä–∞–¥–∞: –¢—ñ–ª—å–∫–∏ —Ç–æ—á–∫–æ–≤–µ —Å–≤—ñ—Ç–ª–æ –∞–±–æ –∑–∞—Ä—è–¥–∫–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–∞.";
    else if (maxW < 7) advice = "\n–ü–æ—Ä–∞–¥–∞: –ú–æ–∂–Ω–∞ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ —Ä–æ—É—Ç–µ—Ä —Ç–∞ –µ–∫–æ–Ω–æ–º–Ω—É –ª–∞–º–ø—É.";
    else advice = "\n–ü–æ—Ä–∞–¥–∞: –ü–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ –≤–∏—Å—Ç–∞—á–∏—Ç—å –Ω–∞–≤—ñ—Ç—å –Ω–∞ –Ω–æ—É—Ç–±—É–∫.";
*/
    alert(result);
    lastReport = "–ó–í–Ü–¢: –°–¢–†–ê–¢–ï–ì–Ü–Ø –í–ò–ñ–ò–í–ê–ù–ù–Ø\n" + result;
    document.getElementById('saveArea').style.display = "block";
}

// 8. –Ü–ù–ñ–ï–ù–ï–†–ù–ò–ô –ê–£–î–ò–¢ –ü–ë (–î–ï–¢–ï–ö–¢–û–† –ë–†–ï–•–ù–Ü)
function auditPowerbank() {
    alert("üîç –ê–£–î–ò–¢ –Ø–ö–û–°–¢–Ü:\n–¶—è —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ—Ä—ñ–≤–Ω—è—î —Ñ–∞–∫—Ç–∏—á–Ω—É —Ä–æ–±–æ—Ç—É –≤–∞—à–æ–≥–æ –ü–ë —ñ–∑ –∑–∞—è–≤–ª–µ–Ω–æ—é —î–º–Ω—ñ—Å—Ç—é.");

    // –ö—Ä–æ–∫ 1: –©–æ –æ–±—ñ—Ü—è–≤ –≤–∏—Ä–æ–±–Ω–∏–∫
    let nominalWh = confirm("–ó–Ω–∞—î—Ç–µ –∑–∞—è–≤–ª–µ–Ω—ñ Wh –ø–∞–≤–µ—Ä–±–∞–Ω–∫–∞?") 
        ? Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh –∑ –∫–æ—Ä–ø—É—Å—É –ü–ë:")) 
        : (Number(prompt("–í–≤–µ–¥—ñ—Ç—å mAh –∑ –∫–æ—Ä–ø—É—Å—É –ü–ë:")) / 1000) * 3.7;

    // –ö—Ä–æ–∫ 2: –©–æ –≤—ñ–¥–±—É–ª–æ—Å—è –Ω–∞—Å–ø—Ä–∞–≤–¥—ñ
    let hours = Number(prompt("–°–∫—ñ–ª—å–∫–∏ –≥–æ–¥–∏–Ω (–≥–æ–¥) –ø—Ä–∞—Ü—é–≤–∞–≤ —Å–ø–æ–∂–∏–≤–∞—á?"));
    let watts = Number(prompt("–Ø–∫–∞ –±—É–ª–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —Å–ø–æ–∂–∏–≤–∞—á–∞ (W)?\n(–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–æ—É—Ç–µ—Ä ‚âà 5W, –ª–∞–º–ø–∞ ‚âà 3W)"));
    let percentUsed = Number(prompt("–°–∫—ñ–ª—å–∫–∏ % –∑–∞—Ä—è–¥—É –ü–ë –Ω–∞ —Ü–µ –≤–∏—Ç—Ä–∞—Ç–∏–ª–æ—Å—è?"));

    if (percentUsed <= 0 || hours <= 0 || watts <= 0) {
        alert("–ü–æ–º–∏–ª–∫–∞: –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ.");
        return;
    }

    // –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê –ê–£–î–ò–¢–£
    let realEnergySpent = watts * hours; // –°–∫—ñ–ª—å–∫–∏ Wh —Ä–µ–∞–ª—å–Ω–æ –≤—ñ–¥–¥–∞–≤ –ü–ë
    let estimatedFullWh = (realEnergySpent / percentUsed) * 100; // –ü—Ä–æ–≥–Ω–æ–∑ 100% —î–º–Ω–æ—Å—Ç—ñ
    let efficiency = (estimatedFullWh / nominalWh) * 100; // –†–µ–∞–ª—å–Ω–∏–π –ö–ö–î –≤—ñ–¥ –Ω–æ–º—ñ–Ω–∞–ª—É

    // –í–ï–†–î–ò–ö–¢
    let verdict = "";
    if (efficiency > 90) verdict = "üíé –í–Ü–î–ú–Ü–ù–ù–û: –ü–∞–≤–µ—Ä–±–∞–Ω–∫ –≤–∏—Å–æ–∫–æ—ó —è–∫–æ—Å—Ç—ñ, —î–º–Ω—ñ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞.";
    else if (efficiency > 75) verdict = "‚úÖ –î–û–ë–†–ï: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å–ø—Ä–∞–≤–Ω–æ–≥–æ –ü–ë.";
    else if (efficiency > 55) verdict = "‚ö†Ô∏è –ü–û–°–ï–†–ï–î–ù–¨–û: –í–µ–ª–∏–∫–∞ –≤—Ç—Ä–∞—Ç–∞ –µ–Ω–µ—Ä–≥—ñ—ó –∞–±–æ –∑–Ω–æ—Å –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞.";
    else verdict = "‚ùå –ö–†–ò–¢–ò–ß–ù–û: –ü–ë –∞–±–æ –¥—É–∂–µ —Å—Ç–∞—Ä–∏–π, –∞–±–æ –≤–∏—Ä–æ–±–Ω–∏–∫ —Å–∏–ª—å–Ω–æ –∑–±—Ä–µ—Ö–∞–≤ –ø—Ä–æ —î–º–Ω—ñ—Å—Ç—å.";

    let report = `–†–ï–ó–£–õ–¨–¢–ê–¢ –ê–£–î–ò–¢–£:
--------------------------
–ó–∞—è–≤–ª–µ–Ω–æ: ${nominalWh.toFixed(2)} Wh
–†–µ–∞–ª—å–Ω–∞ –º—ñ—Å—Ç–∫—ñ—Å—Ç—å: ‚âà${estimatedFullWh.toFixed(2)} Wh
–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: ${efficiency.toFixed(1)}%

–í–µ—Ä–¥–∏–∫—Ç: ${verdict}`;

    alert(report);
    lastReport = "–ó–í–Ü–¢: –ê–£–î–ò–¢ –ü–ë\n" + report;
    document.getElementById('saveArea').style.display = "block";
}
// –ö–Ω–æ–ø–∫–∞ 9
// –ö–Ω–æ–ø–∫–∞ 9: –Ü–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–æ–º–∞—à–Ω—å–æ–≥–æ –±–µ–∫–∞–ø—É (–í–µ—Ä—Å—ñ—è 5.5)
function calcHomeBackup() {
    // –ö–†–û–ö 1: –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ö—ñ–º—ñ—á–Ω–æ–≥–æ —Ç–∏–ø—É –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞
    // –¶–µ –≤–∞–∂–ª–∏–≤–æ, –±–æ –ª—ñ—Ç—ñ–π —Ç–∞ —Å–≤–∏–Ω–µ—Ü—å –º–∞—é—Ç—å —Ä—ñ–∑–Ω–∏–π –ö–ö–î —Ç–∞ –ø—Ä–∞–≤–∏–ª–∞ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó
    let type = prompt("–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Å–∏—Å—Ç–µ–º–∏:\n1 - LiFePO4 (–°—Ç–∞–Ω—Ü—ñ—è/LFP)\n2 - –°–≤–∏–Ω—Ü–µ–≤–∏–π (–ê–≤—Ç–æ/Pb/AGM)");
    
    if (type !== "1" && type !== "2") {
        alert("–ü–æ–º–∏–ª–∫–∞: –æ–±–µ—Ä—ñ—Ç—å 1 –∞–±–æ 2");
        return;
    }

    let totalWh = 0; // –ó–∞–≥–∞–ª—å–Ω–∞ –µ–Ω–µ—Ä–≥–æ—î–º–Ω—ñ—Å—Ç—å —É –í–∞—Ç—Ç-–≥–æ–¥–∏–Ω–∞—Ö
    let efficiencyFactor = 0; // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –≤—Ç—Ä–∞—Ç (–Ü–Ω–≤–µ—Ä—Ç–æ—Ä + –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –æ–ø—ñ—Ä)

    // –ö–†–û–ö 2: –õ–æ–≥—ñ–∫–∞ –¥–ª—è —Å—É—á–∞—Å–Ω–∏—Ö LiFePO4 –∞–∫—É–º—É–ª—è—Ç–æ—Ä—ñ–≤ (EcoFlow, Bluetti —Ç–æ—â–æ)
    if (type === "1") {
        efficiencyFactor = 1.05; // –í–∏—Å–æ–∫–∏–π –ö–ö–î (~95%), –≤—Ç—Ä–∞—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ
        let mode = prompt("–í–∏ –∑–Ω–∞—î—Ç–µ —î–º–Ω—ñ—Å—Ç—å —É Wh? (1-–¢–∞–∫, 2-–ù—ñ, –∑–Ω–∞—é –≤ Ah, 3-–ù—ñ, –∑–Ω–∞—é –≤ mAh)");
        
        if (mode === "1") {
            totalWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh –±–∞—Ç–∞—Ä–µ—ó:"));
        } else if (mode === "2") {
            let ah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Ah:"));
            // –î–ª—è LFP –∫–æ–º—ñ—Ä–æ–∫ –Ω–æ–º—ñ–Ω–∞–ª—å–Ω–∞ –Ω–∞–ø—Ä—É–≥–∞ –∑–∞–∑–≤–∏—á–∞–π 3.2V
            totalWh = ah * 3.2; 
        } else {
            let mah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å mAh:"));
            totalWh = (mah / 1000) * 3.2;
        }
    } 
    // –ö–†–û–ö 3: –õ–æ–≥—ñ–∫–∞ –¥–ª—è —Å–≤–∏–Ω—Ü–µ–≤–∏—Ö –∞–∫—É–º—É–ª—è—Ç–æ—Ä—ñ–≤ (–Ω–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∞ —á–∞—Å—Ç–∏–Ω–∞)
    else {
        // –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç 1.35 –≤—Ä–∞—Ö–æ–≤—É—î —Å–∏–ª—å–Ω–µ –Ω–∞–≥—Ä—ñ–≤–∞–Ω–Ω—è —ñ–Ω–≤–µ—Ä—Ç–æ—Ä–∞ —Ç–∞ –Ω–∏–∑—å–∫–∏–π –ö–ö–î —Å–≤–∏–Ω—Ü—é
        efficiencyFactor = 1.35; 
        let mode = prompt("–í–∏ –∑–Ω–∞—î—Ç–µ —î–º–Ω—ñ—Å—Ç—å —É Wh? (1-–¢–∞–∫, 2-–ù—ñ, –∑–Ω–∞—é –≤ Ah)");
        
        if (mode === "1") {
            totalWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh:"));
        } else {
            let ah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Ah:"));
            let v = Number(prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É V (6, 12 –∞–±–æ 24):"));
            totalWh = ah * v;
        }
        
        // –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è —ñ–Ω–∂–µ–Ω–µ—Ä–Ω–∏—Ö –æ–±–º–µ–∂–µ–Ω—å:
        // 1. DoD 50% (0.50) ‚Äî —Ä–æ–∑—Ä—è–¥–∂–∞—Ç–∏ —Å–≤–∏–Ω–µ—Ü—å –≥–ª–∏–±—à–µ –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ –¥–ª—è –π–æ–≥–æ "–∑–¥–æ—Ä–æ–≤'—è"
        // 2. –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ü–µ–π–∫–µ—Ä—Ç–∞ (1.15) ‚Äî –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–æ—ó —î–º–Ω–æ—Å—Ç—ñ –ø—Ä–∏ –≤–µ–ª–∏–∫–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        totalWh = (totalWh * 0.50) / 1.15; 
    }

    // –ö–†–û–ö 4: –ó–±—ñ—Ä –¥–∞–Ω–∏—Ö –ø—Ä–æ —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ (–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–∏—Å—Ç–µ–º—É)
    let totalPower = 0;
    let count = Number(prompt("–°–∫—ñ–ª—å–∫–∏ —Ç–∏–ø—ñ–≤ —Å–ø–æ–∂–∏–≤–∞—á—ñ–≤ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ? (–Ω–∞–ø—Ä. —Ä–æ—É—Ç–µ—Ä, –ª–∞–º–ø–∞, –Ω–æ—É—Ç–±—É–∫)"));

    for (let i = 1; i <= count; i++) {
        let pMode = prompt(`–°–ø–æ–∂–∏–≤–∞—á ‚Ññ${i}:\n1 - –ó–Ω–∞—é –í–∞—Ç–∏ (W)\n2 - –ó–Ω–∞—é –í–æ–ª—å—Ç–∏ (V) —Ç–∞ –ê–º–ø–µ—Ä–∏ (A)`);
        if (pMode === "1") {
            totalPower += Number(prompt(`–í–≤–µ–¥—ñ—Ç—å –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å (W) –¥–ª—è ‚Ññ${i}:`));
        } else {
            let v = Number(prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É (V):"));
            let a = Number(prompt("–í–≤–µ–¥—ñ—Ç—å —Å—Ç—Ä—É–º (A):"));
            totalPower += (v * a); // –ó–∞–∫–æ–Ω –û–º–∞: P = U * I
        }
    }

    // –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∫—Ä–∏—Ç–∏—á–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏: –¥—ñ–ª–µ–Ω–Ω—è –Ω–∞ –Ω—É–ª—å
    if (totalPower === 0) {
        alert("–ü–æ–º–∏–ª–∫–∞: –í–∏ –Ω–µ –≤–≤–µ–ª–∏ –∂–æ–¥–Ω–æ–≥–æ —Å–ø–æ–∂–∏–≤–∞—á–∞!");
        return;
    }

    // –ö–†–û–ö 5: –û—Å–Ω–æ–≤–Ω–∏–π –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —á–∞—Å—É
    // –ß–∞—Å = –Ñ–º–Ω—ñ—Å—Ç—å / (–ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è * –ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –≤—Ç—Ä–∞—Ç)
    let hours = totalWh / (totalPower * efficiencyFactor);
    let totalMinutes = hours * 60;

    // –ö–†–û–ö 6: –ü—Ä–æ–≥–Ω–æ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –≤–∏–º–∫–Ω–µ–Ω–Ω—è (Smart Clock)
    let now = new Date(); // –ë–µ—Ä–µ–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —á–∞—Å —ñ–∑ —Å–∏—Å—Ç–µ–º–∏
    // –†–æ–∑—Ä–∞—Ö–æ–≤—É—î–º–æ —á–∞—Å –≤–∏—á–µ—Ä–ø–∞–Ω–Ω—è –∑–∞—Ä—è–¥—É, –¥–æ–¥–∞—é—á–∏ —Ö–≤–∏–ª–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏ –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç—É
    let offTime = new Date(now.getTime() + totalMinutes * 60000);
    
    let hoursOut = offTime.getHours();
    let minsOut = offTime.getMinutes();
    // –§–æ—Ä–º–∞—Ç—É—î–º–æ —Ö–≤–∏–ª–∏–Ω–∏, —â–æ–± –±—É–ª–æ "05" –∑–∞–º—ñ—Å—Ç—å "5"
    let timeStr = `${hoursOut}:${minsOut < 10 ? '0' : ''}${minsOut}`;

    // –ö–†–û–ö 7: –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–≤—ñ—Ç—É –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    let resultMsg = `üìä –ó–í–Ü–¢ HOME BACKUP (v5.5):\n`;
    resultMsg += `--------------------------\n`;
    resultMsg += `–¢–∏–ø –ê–ö–ë: ${type === "1" ? "LiFePO4" : "–°–≤–∏–Ω–µ—Ü—å (Pb)"}\n`;
    resultMsg += `–°—É–º–∞—Ä–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: ${totalPower.toFixed(1)} W\n`;
    resultMsg += `–í—Ä–∞—Ö–æ–≤—É—é—á–∏ –ö–ö–î —Å–∏—Å—Ç–µ–º–∏: ${(totalPower * efficiencyFactor).toFixed(1)} W\n`;
    resultMsg += `--------------------------\n`;
    resultMsg += `‚åõ –ß–∞—Å —Ä–æ–±–æ—Ç–∏: ${Math.floor(hours)}–≥ ${Math.round(totalMinutes % 60)}—Ö–≤\n`;
    resultMsg += `üî¥ –°–≤—ñ—Ç–ª–æ –∑–≥–∞—Å–Ω–µ –æ: ${timeStr}\n`;
    
    // –î–æ–¥–∞—Ç–∫–æ–≤–µ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–≤–∏–Ω—Ü–µ–≤–∏—Ö –∞–∫—É–º—É–ª—è—Ç–æ—Ä—ñ–≤
    if (type === "2") {
        resultMsg += `\n‚ö†Ô∏è –ü–†–ò–ú–Ü–¢–ö–ê: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –æ–±–º–µ–∂–µ–Ω–æ –¥–æ 50% (DoD), —â–æ–± –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ—Å—É—Ä—Å –≤–∞—à–æ–≥–æ –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞.`;
    }

    alert(resultMsg);
}

//–ö–Ω–æ–ø–∫–∞ 10
function calcRecharge() {
    let type = prompt("–¢–∏–ø –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞ –¥–ª—è –∑–∞—Ä—è–¥–∫–∏:\n1 - LiFePO4 (LFP)\n2 - –°–≤–∏–Ω—Ü–µ–≤–∏–π (Pb/AGM/GEL)");
    if (type !== "1" && type !== "2") return;

    let totalWh = 0;
    let voltage = 12; // –ë–∞–∑–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –ê–º–ø–µ—Ä—ñ–≤

    // --- –õ–û–ì–Ü–ö–ê –í–í–û–î–£ –ï–ù–ï–†–ì–Ü–á (–¢–≤–æ—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞) ---
    if (type === "1") {
        voltage = 3.2; 
        let mode = prompt("–Ñ–º–Ω—ñ—Å—Ç—å LiFePO4:\n1 - –ó–Ω–∞—é Wh\n2 - –ó–Ω–∞—é Ah\n3 - –ó–Ω–∞—é mAh");
        if (mode === "1") {
            totalWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh –±–∞—Ç–∞—Ä–µ—ó:"));
        } else if (mode === "2") {
            let ah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Ah:"));
            totalWh = ah * 3.2; 
        } else {
            let mah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å mAh:"));
            totalWh = (mah / 1000) * 3.2;
        }
    } else {
        let mode = prompt("–Ñ–º–Ω—ñ—Å—Ç—å –°–≤–∏–Ω—Ü–µ–≤–æ–≥–æ –ê–ö–ë:\n1 - –ó–Ω–∞—é Wh\n2 - –ó–Ω–∞—é Ah");
        if (mode === "1") {
            totalWh = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Wh:"));
        } else {
            let ah = Number(prompt("–í–≤–µ–¥—ñ—Ç—å Ah:"));
            let v = Number(prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–ø—Ä—É–≥—É V (–∑–∞–∑–≤–∏—á–∞–π 12):"));
            voltage = v;
            // –¢–≤–æ—è —Ñ–æ—Ä–º—É–ª–∞: ((Ah * V) * 0.50) * 1.15
            totalWh = (ah * v * 0.50) * 1.15;
        }
    }

    let currentPerc = Number(prompt("–ù–∞ —Å–∫—ñ–ª—å–∫–∏ % –ó–ê–†–ê–ó –∑–∞—Ä—è–¥–∂–µ–Ω–∏–π –∞–∫—É–º—É–ª—è—Ç–æ—Ä?"));
    let chargePowerW = Number(prompt("–ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å –∑–∞—Ä—è–¥–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (W):"));

    if (totalWh <= 0 || chargePowerW <= 0) {
        alert("–ü–æ–º–∏–ª–∫–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö!");
        return;
    }

    // –†–∞—Ö—É—î–º–æ —Å–∫—ñ–ª—å–∫–∏ Wh —Ç—Ä–µ–±–∞ "–¥–æ–ª–∏—Ç–∏"
    let neededWh = totalWh * ((100 - currentPerc) / 100);
    let chargeTimeH = 0;
    let resultMsg = `‚ö° –†–ï–ì–ï–ù–ï–†–ê–¶–Ü–Ø –ï–ù–ï–†–ì–Ü–á:\n--------------------------\n`;

    if (type === "1") {
        // LiFePO4: –ö–ö–î 95% + –º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ —Å–ø–æ–≤—ñ–ª—å–Ω–µ–Ω–Ω—è
        chargeTimeH = (neededWh / (chargePowerW * 0.95)) * 1.05;
        resultMsg += `–¢–∏–ø: LiFePO4 (LFP)\n`;
    } else {
        // –°–≤–∏–Ω–µ—Ü—å: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –±–µ–∑–ø–µ—á–Ω–∏–π —Å—Ç—Ä—É–º (0.2C)
        let maxSafeW = (totalWh / 0.575) * 0.2; // –û–±–µ—Ä–Ω–µ–Ω–∞ —Ñ–æ—Ä–º—É–ª–∞ –¥–æ —Ç–≤–æ—î—ó —î–º–Ω–æ—Å—Ç—ñ
        if (chargePowerW > maxSafeW) {
            resultMsg += `‚ö†Ô∏è –£–í–ê–ì–ê: –í–µ–ª–∏–∫–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å! –ú–æ–∂–ª–∏–≤–µ –∑–∞–∫–∏–ø–∞–Ω–Ω—è Pb.\n`;
        }
        // –°–≤–∏–Ω–µ—Ü—å: –ö–ö–î 75% + –¥–æ–≤–≥–∞ —Ñ–∞–∑–∞ –Ω–∞—Å–∏—á–µ–Ω–Ω—è (x1.5)
        chargeTimeH = (neededWh / (chargePowerW * 0.75)) * 1.5;
        resultMsg += `–¢–∏–ø: –°–≤–∏–Ω—Ü–µ–≤–∏–π (Pb)\n`;
    }

    let totalMinutes = chargeTimeH * 60;
    
    // –ü—Ä–æ–≥–Ω–æ–∑ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ
    let now = new Date();
    let readyTime = new Date(now.getTime() + totalMinutes * 60000);
    let timeStr = `${readyTime.getHours()}:${readyTime.getMinutes() < 10 ? '0' : ''}${readyTime.getMinutes()}`;

    resultMsg += `--------------------------\n`;
    resultMsg += `‚åõ –ß–∞—Å –¥–æ –ø–æ–≤–Ω–æ—ó –∑–∞—Ä—è–¥–∫–∏: ${Math.floor(chargeTimeH)}–≥ ${Math.round(totalMinutes % 60)}—Ö–≤\n`;
    resultMsg += `‚úÖ –ë—É–¥–µ –≥–æ—Ç–æ–≤–æ –æ: ${timeStr}\n`;

    alert(resultMsg);
}


renderDeviceList();
</script>
<p style="color: #666; font-size: 12px; margin-top: 20px;">
   –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –∑–∞ –ª–æ–≥—ñ–∫–æ—é –ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä–∞ (15 —Ä–æ–∫—ñ–≤). –ê–≤—Ç–æ—Ä: Tiberii de Spartak. –†–æ–∑—Ä–∞—Ö—É–Ω–∫–∏ –±–∞–∑—É—é—Ç—å—Å—è –Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∏—Ö –º–æ–¥–µ–ª—è—Ö Li-ion.
</p>

</body>
</html>
